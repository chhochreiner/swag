«IMPORT metamodel»

«EXTENSION template::GeneratorExtensions»

«DEFINE main FOR Model»
	«EXPAND dao FOREACH entities()»
«ENDDEFINE»

«DEFINE dao FOR Entity»
	«FILE packagePath() + "/dao/" + name + "DAO.java"»
		package «package()».dao;
		
		import java.util.Date;
		import java.util.List;
		import javax.persistence.EntityManager;
		
		import com.google.inject.Inject;
		import com.google.inject.persist.Transactional;
		
		import «package()».domain.*;
		
		public class «name»DAO extends AbstractDAO<«name»> {
			
			@Inject
			public «name»DAO( EntityManager em ) {
				super( em );
			}

			@Transactional
			@Override
			@SuppressWarnings("unchecked")
			public Iterable<«name»> getAll() {
				return getEntityManager().createQuery( "SELECT obj FROM «name» obj" ).getResultList();
			}
			
			@Transactional
			@Override
			@SuppressWarnings("unchecked")
			public void deleteAll() {
				getEntityManager().createQuery( "DELETE FROM «name»" ).executeUpdate();
			}

			«FOREACH attributes AS attr»
				«IF attr.unique»
					@Transactional
					@SuppressWarnings("unchecked")
					public «name» findBy«attr.name.toFirstUpper()»( «attr.type.name» «attr.name» ) {
						return («name») getEntityManager().createQuery(
							"SELECT obj FROM «name» obj WHERE obj.«attr.name» = :val" )
							.setParameter( "val", «attr.name» )
							.getSingleResult();
					}
				«ELSE»
					@Transactional
					@SuppressWarnings("unchecked")
					public List<«name»> findBy«attr.name.toFirstUpper()»( «attr.type.name» «attr.name» ) {
						return getEntityManager().createQuery(
							"SELECT obj FROM «name» obj WHERE obj.«attr.name» = :val" )
							.setParameter( "val", «attr.name» )
							.getResultList();
					}
				«ENDIF»
			«ENDFOREACH»

			protected Class<«name»> getEntityClass() {
				return «name».class;
			}
		}		
	«ENDFILE»
«ENDDEFINE»
